generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  password      String
  role          String    // CONTESTANT, JUDGE, ADMIN
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  photo         Photo?
  votes         Vote[]
  
  @@map("users")
}

model Photo {
  id            String    @id @default(cuid())
  title         String
  description   String?
  fileUrl       String
  fileKey       String
  uploadedAt    DateTime  @default(now())
  
  contestantId  String    @unique
  contestant    User      @relation(fields: [contestantId], references: [id], onDelete: Cascade)
  
  votes         Vote[]
  voteCount     Int       @default(0)
  
  @@map("photos")
}

model Vote {
  id            String    @id @default(cuid())
  createdAt     DateTime  @default(now())
  
  judgeId       String
  judge         User      @relation(fields: [judgeId], references: [id], onDelete: Cascade)
  
  photoId       String
  photo         Photo     @relation(fields: [photoId], references: [id], onDelete: Cascade)
  
  @@unique([judgeId, photoId])
  @@map("votes")
}

model ContestSettings {
  id                String   @id @default(cuid())
  phase             String   @default("REGISTRATION")
  registrationEnd   DateTime?
  judgingEnd        DateTime?
  maxFileSize       Int      @default(10485760)
  allowedFileTypes  String   @default("image/jpeg,image/png,image/webp")
  updatedAt         DateTime @updatedAt
  
  @@map("contest_settings")
}